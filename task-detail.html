<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Details - CashByKing</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }

    :root { 
      --bg-color: #0a0e27; 
      --card-bg: #141b3a; 
      --text-color: #e2e8f0; 
      --accent-color: #6366f1; 
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --border-color: rgba(255,255,255,0.1); 
    }

    body { 
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      padding-bottom: 150px;
    }

    .top-bar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: var(--accent-color);
      border-radius: 50px;
      color: white;
      text-decoration: none;
      font-weight: 700;
      font-size: 14px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 20px 80px 20px;
    }

    /* Reward Header */
    .reward-header {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      margin-bottom: 30px;
      box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3);
    }

    .reward-amount {
      font-size: 56px;
      font-weight: 900;
      color: white;
      margin-bottom: 10px;
      text-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .reward-label {
      font-size: 18px;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
    }

    /* Task Title */
    .task-title-card {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
      border: 1px solid var(--border-color);
    }

    .task-title {
      font-size: 28px;
      font-weight: 800;
      line-height: 1.3;
      margin-bottom: 15px;
    }

    .task-description {
      font-size: 16px;
      line-height: 1.6;
      opacity: 0.8;
    }

    /* How to Complete Section */
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 20px;
      color: var(--accent-color);
    }

    .section-header i {
      font-size: 28px;
    }

    /* Steps */
    .steps-container {
      margin-bottom: 30px;
    }

    .step-item {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 15px;
      border: 2px solid var(--border-color);
      display: flex;
      align-items: flex-start;
      gap: 20px;
      transition: all 0.3s ease;
    }

    .step-item:hover {
      border-color: var(--accent-color);
      transform: translateX(5px);
    }

    .step-number {
      min-width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-color), #764ba2);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 900;
      flex-shrink: 0;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    }

    .step-content {
      flex: 1;
      padding-top: 5px;
    }

    .step-text {
      font-size: 18px;
      font-weight: 600;
      line-height: 1.5;
    }

    /* Timer Warning */
    .timer-warning {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 15px;
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
    }

    .timer-warning i {
      font-size: 32px;
      color: white;
    }

    .timer-warning-text {
      flex: 1;
      color: white;
    }

    .timer-warning-text h4 {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .timer-warning-text p {
      font-size: 14px;
      opacity: 0.9;
    }

    /* Important Note */
    .important-note {
      background: rgba(239, 68, 68, 0.1);
      border: 2px solid #ef4444;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 25px;
    }

    .important-note h4 {
      color: #ef4444;
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .important-note p {
      font-size: 15px;
      line-height: 1.6;
      opacity: 0.9;
    }

    /* Action Buttons */
    .action-buttons {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--card-bg);
      border-top: 1px solid var(--border-color);
      padding: 20px;
      display: flex;
      gap: 15px;
      box-shadow: 0 -10px 30px rgba(0,0,0,0.3);
      z-index: 50;
    }

    .btn {
      flex: 1;
      padding: 18px;
      border-radius: 16px;
      border: none;
      font-size: 18px;
      font-weight: 800;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s ease;
    }

    .btn i {
      font-size: 22px;
    }

    .btn-visit {
      background: linear-gradient(135deg, #3b82f6, #1e40af);
      color: white;
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    }

    .btn-visit:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(59, 130, 246, 0.5);
    }

    .btn-submit {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(16, 185, 129, 0.5);
    }

    @media (max-width: 768px) {
      .reward-amount {
        font-size: 42px;
      }

      .task-title {
        font-size: 22px;
      }

      .section-header {
        font-size: 20px;
      }

      .step-text {
        font-size: 16px;
      }

      .action-buttons {
        flex-direction: column;
        gap: 12px;
      }

      .btn {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <a href="/dashboard" class="back-btn">
      <i class="fas fa-arrow-left"></i>
      <span>Back</span>
    </a>
  </div>

  <div class="container">
    <!-- Reward Header -->
    <div class="reward-header">
      <div class="reward-amount">‚Çπ<span id="taskReward">0</span></div>
      <div class="reward-label">üéÅ Earn karo is task ko complete karke!</div>
    </div>

    <!-- Task Title & Description -->
    <div class="task-title-card">
      <h1 class="task-title" id="taskTitle">Loading...</h1>
      <p class="task-description" id="taskDescription">Loading...</p>
    </div>

    <!-- Timer Warning (if applicable) -->
    <div class="timer-warning" id="timerWarning" style="display: none;">
      <i class="fas fa-stopwatch"></i>
      <div class="timer-warning-text">
        <h4>‚è∞ Time Limit Hai!</h4>
        <p>Task complete karne ke liye <strong><span id="timerSeconds">0</span> seconds</strong> ka time hai</p>
      </div>
    </div>

    <!-- How to Complete Section -->
    <h2 class="section-header">
      <i class="fas fa-clipboard-check"></i>
      Kaise Complete Kare?
    </h2>

    <div class="steps-container" id="stepsContainer">
      <!-- Steps will be inserted here -->
    </div>

    <!-- Important Note -->
    <div class="important-note">
      <h4>
        <i class="fas fa-exclamation-triangle"></i>
        Important Instructions
      </h4>
      <p id="taskInstruction">Loading...</p>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="btn btn-visit" id="visitBtn">
      <i class="fas fa-external-link-alt"></i>
      <span>Visit Task</span>
    </button>
    <button class="btn btn-submit" id="submitBtn">
      <i class="fas fa-check-circle"></i>
      <span>Submit Task</span>
    </button>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const taskId = urlParams.get('id');

    if (!taskId) {
      window.location.href = '/dashboard';
    }

    let currentTask = null;

    async function loadTaskDetails() {
      try {
        const response = await fetch('/api/tasks/available');
        const data = await response.json();

        if (data.success) {
          const task = data.tasks.find(t => t.id == taskId);
          if (!task) {
            Swal.fire({
              icon: 'error',
              title: 'Task Nahi Mila',
              text: 'Yeh task ab available nahi hai',
              confirmButtonColor: '#ef4444'
            }).then(() => {
              window.location.href = '/dashboard';
            });
            return;
          }

          currentTask = task;

          // Set basic info
          document.getElementById('taskTitle').textContent = task.title;
          document.getElementById('taskReward').textContent = parseFloat(task.price).toFixed(0);
          document.getElementById('taskDescription').textContent = task.description;
          document.getElementById('taskInstruction').textContent = task.instruction;

          // Show timer if exists
          if (task.timer && task.timer > 0) {
            document.getElementById('timerWarning').style.display = 'flex';
            document.getElementById('timerSeconds').textContent = task.timer;
          }

          // Create steps
          const stepsContainer = document.getElementById('stepsContainer');

          if (task.steps && task.steps.trim()) {
            const steps = task.steps.split('\n').filter(s => s.trim());
            steps.forEach((step, index) => {
              const stepDiv = document.createElement('div');
              stepDiv.className = 'step-item';
              stepDiv.innerHTML = `
                <div class="step-number">${index + 1}</div>
                <div class="step-content">
                  <div class="step-text">${step.trim()}</div>
                </div>
              `;
              stepsContainer.appendChild(stepDiv);
            });
          } else {
            // Default steps if no custom steps
            const defaultSteps = [
              'Niche "Visit Task" button par click karo',
              'Task ko carefully complete karo (screenshot lena mat bhoolna)',
              'Task complete hone ke baad yaha wapas aao',
              '"Submit Task" button par click karke submit karo'
            ];

            defaultSteps.forEach((step, index) => {
              const stepDiv = document.createElement('div');
              stepDiv.className = 'step-item';
              stepDiv.innerHTML = `
                <div class="step-number">${index + 1}</div>
                <div class="step-content">
                  <div class="step-text">${step}</div>
                </div>
              `;
              stepsContainer.appendChild(stepDiv);
            });
          }
        }
      } catch (error) {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Task load karne mein problem aayi',
          confirmButtonColor: '#ef4444'
        });
      }
    }

    loadTaskDetails();

    // Visit Task Button
    document.getElementById('visitBtn').addEventListener('click', () => {
      if (currentTask && currentTask.task_url) {
        window.open(currentTask.task_url, '_blank');
        Swal.fire({
          icon: 'success',
          title: 'Task Opened! üöÄ',
          text: 'Task complete karke yaha wapas aao aur submit karo',
          timer: 3000,
          showConfirmButton: false
        });
      } else {
        Swal.fire({
          icon: 'warning',
          title: 'URL Available Nahi Hai',
          text: 'Instructions check karo task ke baare mein',
          confirmButtonColor: '#f59e0b'
        });
      }
    });

    // Submit Task Button
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const result = await Swal.fire({
        title: 'Task Complete Kar Liya?',
        text: 'Confirm karo ki tumne task pura kar liya hai',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#10b981',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'Haan, Submit Karo',
        cancelButtonText: 'Nahi, Abhi Nahi'
      });

      if (!result.isConfirmed) return;

      try {
        const response = await fetch('/api/tasks/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ taskId: parseInt(taskId) })
        });

        const data = await response.json();

        if (data.success) {
          await Swal.fire({
            icon: 'success',
            title: 'Task Submitted! üéâ',
            html: `<strong>${data.message}</strong>`,
            confirmButtonColor: '#10b981',
            timer: 3000
          });
          window.location.href = '/dashboard';
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Submission Failed',
            text: data.message,
            confirmButtonColor: '#ef4444'
          });
        }
      } catch (error) {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Task submit karne mein problem aayi',
          confirmButtonColor: '#ef4444'
        });
      }
    });
  </script>
</body>
</html>